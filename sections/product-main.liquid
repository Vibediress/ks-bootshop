{% liquid
  assign variants_json = product.variants | json
%}

<section 
  id="product-main{{ product.id }}" 
  class="
    product-main
    {{ section.settings.bg_color }} 
    {{ section.settings.bg_gradient }}
    {{ section.settings.text_color }} 
    {{ section.settings.border_top_width | prepend: 'border-top-' }}
    {{ section.settings.border_bottom_width | prepend: 'border-bottom-' }}
    {{ section.settings.border_color }} 
    {{ section.settings.pt | prepend: 'pt-0 pt-tablet-' }}
    {{ section.settings.pb | prepend: 'pb-' }}
  "
  style="
    --bs-bg-opacity: {{ section.settings.bg_opacity | append: '%' }};
    --bs-border-opacity: {{ section.settings.border_opacity | append: '%' }};
  ">
  <div 
    class="container" 
    style="max-width: {{ section.settings.container_max_width | append: 'px' }};">
    <div 
      class="product-contents position-relative"
      data-quick-view-contents
      data-recently-viewed-set
      data-product-url="{{ product.url }}">
      <a class="visually-hidden-focusable" href="#product-inner-{{ product.id }}">
        {{ 'general.accessibility.skip_product_content' | t }}
      </a>      
      <div class="row">
        <div class="col-desktop-9 mb-5 mb-desktop-0">
          {% render 'product-block-media-gallery' %}
        </div>
        <div class="col-desktop-9">
          <div id="product-inner-{{ product.id }}">
            <product-form>
              {% form 'product', product, data-productid: product.id, data-variants: variants_json %}
                <input type="hidden" name="id" data-productid="{{ product.id }}" value="{{ product.selected_or_first_available_variant.id }}">
                {% liquid
                  for block in section.blocks
                    case block.type
                      when 'title'
                        render 'product-block-title', block: block
                      when 'price'
                        render 'product-block-price', block: block, form: form
                      when 'options'
                        render 'product-block-options', block: block, form: form
                      when 'atc_button'
                        render 'product-block-atc-button', block: block, form: form
                      when 'richtext'
                        render 'product-block-richtext', block: block
                      when 'collapse'
                        render 'product-block-collapse', block: block
                      when 'liquid'
                        render 'product-block-liquid', block: block
                      when 'trust_icons'
                        render 'product-block-trust-icons', block: block
                      when 'separator'
                        render 'product-block-separator', block: block
                      when 'stock_indicator'
                        render 'product-block-stock-indicator', block: block
                      when '@app'
                        render block
                    endcase
                  endfor
                %}
              {% endform %}
            </product-form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Ajout du script dynamique -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    let variantDropdown = document.querySelector("[name='id']");
    let priceElement = document.getElementById("dynamic-price");

    let variants = {{ variants_json | json }};

    if (variantDropdown && priceElement) {
        variantDropdown.addEventListener("change", function() {
            let selectedVariantId = this.value;
            let selectedVariant = variants.find(variant => variant.id == selectedVariantId);

            if (selectedVariant) {
                priceElement.innerText = new Intl.NumberFormat("fr-FR", { style: "currency", currency: "EUR" }).format(selectedVariant.price / 100);
            }
        });
    }
});
</script>

{% schema %}
{
  "name": "Product main",
  "settings": [
    {
      "type": "header",
      "content": "Styling"
    },
    {
      "type": "select",
      "id": "bg_color",
      "label": "Background color",
      "default": "bg-body",
      "options": [
        { "value": "bg-primary", "label": "Primary" },
        { "value": "bg-secondary", "label": "Secondary" },
        { "value": "bg-body", "label": "Body" },
        { "value": "bg-white", "label": "White" }
      ]
    },
    {
      "type": "range",
      "id": "bg_opacity",
      "label": "Background opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 100,
      "unit": "%"
    },
    {
      "type": "select",
      "id": "bg_gradient",
      "label": "Background gradient",
      "options": [
        { "value": "bg-gradient", "label": "Yes" },
        { "value": "", "label": "No" }
      ],
      "default": ""
    },
    {
      "type": "checkbox",
      "id": "bg_left_right_gradients",
      "label": "Background left/right gradients",
      "default": true
    },
    {
      "type": "select",
      "id": "text_color",
      "label": "Text color",
      "default": "text-body",
      "options": [
        { "value": "text-primary", "label": "Primary" },
        { "value": "text-secondary", "label": "Secondary" },
        { "value": "text-body", "label": "Body" },
        { "value": "text-white", "label": "White" }
      ]
    }
  ],
  "templates": ["product"],
  "presets": [
    {
      "name": "Product main"
    }
  ]
}
{% endschema %}
